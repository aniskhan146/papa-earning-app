<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PAPA TAP Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Monetag SDK -->
    <script src="//libtl.com/sdk.js" data-zone="9678845" data-sdk="show_9678845"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style> body{font-family:'Poppins',sans-serif;overflow:hidden} .page{display:none;height:100%;flex-direction:column} .page.active{display:flex} .tap-circle.tapped{transform:scale(.95)} .floating-number{position:absolute;font-size:2.5rem;font-weight:800;color:#fff;opacity:1;transition:all 1s ease-out;pointer-events:none;text-shadow:0 2px 4px #00000080} </style>
</head>
<body class="bg-gradient-to-b from-yellow-400 via-orange-500 to-red-600 text-white select-none">
<div id="app-container" class="flex flex-col h-screen max-w-md mx-auto bg-black/40 backdrop-blur-sm">
<main class="flex-grow overflow-hidden">
    <!-- EARN PAGE -->
    <div id="earnPage" class="page active p-4 space-y-4">
        <!-- (à¦†à¦—à§‡à¦° à¦®à¦¤à§‹à¦‡, à¦…à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤) -->
        <header class="flex items-center justify-around space-x-2 bg-black/20 p-2 rounded-2xl"> <div class="flex items-center space-x-1.5"><img src="https://img.icons8.com/fluency/48/stack-of-coins.png" alt="coin" class="w-7 h-7"><p id="coinBalance" class="font-bold">0</p></div><div class="flex items-center space-x-1.5"><img src="https://img.icons8.com/color/48/us-dollar-circled--v1.png" alt="usdt" class="w-7 h-7"><p id="usdtBalance" class="font-bold">0.00</p></div><div class="flex items-center space-x-1.5"><svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24ZM11.6596 5.33445C11.1969 5.33445 10.8242 5.70718 10.8242 6.16988V13.8055L6.99619 11.232C6.54133 10.9329 5.92336 11.0825 5.62419 11.5373C5.32503 11.9922 5.4746 12.6102 5.92947 12.9093L11.0421 16.5372C11.4552 16.8093 11.979 16.7441 12.3082 16.3917L18.3444 9.94726C18.7291 9.53775 18.6946 8.88714 18.285 8.50244C17.8755 8.11774 17.2249 8.15227 16.8402 8.56178L12.495 13.2085V6.16988C12.495 5.70718 12.1223 5.33445 11.6596 5.33445Z" fill="white"></path></svg><p id="tonBalance" class="font-bold">0.00</p></div></header>
        <section class="flex justify-between items-center px-2"> <button type="button" class="bg-gray-800/80 px-4 py-2 rounded-lg font-semibold flex items-center space-x-2"><img src="https://img.icons8.com/arcade/64/trophy.png" alt="trophy" class="w-6 h-6"/> <span id="leagueName">Gold</span> </button> <button type="button" onclick="showPage('adsPage')" class="bg-red-600 px-6 py-2 rounded-lg font-bold">Ads to Earn</button> </section>
        <div id="tap-area" class="flex-grow flex flex-col items-center justify-center relative"> <div id="tap-circle" class="tap-circle w-60 h-60 bg-gradient-to-br from-red-500 to-orange-600 rounded-full flex items-center justify-center shadow-2xl transition-transform duration-75 ease-in-out cursor-pointer"> <p class="text-3xl font-black">Click Game<br>Tap Tap</p> </div> </div>
        <section class="flex items-center justify-between px-2"> <div class="flex items-center space-x-2"> <img src="https://img.icons8.com/stickers/100/lightning-bolt.png" alt="energy" class="w-10 h-10"/> <p id="energyCounter" class="text-2xl font-bold">200</p> </div> <button type="button" class="bg-red-500 hover:bg-red-600 font-bold py-3 px-8 rounded-full shadow-lg">ðŸš€ Boost</button> </section>
    </div>

    <!-- ADS PAGE (à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦¨à¦¤à§à¦¨ à¦à¦¬à¦‚ à¦†à¦ªà¦¡à§‡à¦Ÿ à¦•à¦°à¦¾) -->
    <div id="adsPage" class="page p-4 overflow-y-auto">
        <h1 class="text-3xl font-bold text-center mb-6">Ads For Coins</h1>
        <p class="text-sm text-center text-gray-400 mb-6">Watch an ad to claim your reward. Some tasks may have a cooldown.</p>
        <div id="adTaskList" class="space-y-3">
            <!-- à¦¬à¦¿à¦œà§à¦žà¦¾à¦ªà¦¨ à¦Ÿà¦¾à¦¸à§à¦•à¦—à§à¦²à§‹ à¦à¦–à¦¾à¦¨à§‡ à¦œà¦¾à¦­à¦¾à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿ à¦¦à¦¿à§Ÿà§‡ à¦¯à§‹à¦— à¦•à¦°à¦¾ à¦¹à¦¬à§‡ -->
        </div>
        <p id="adTaskMessage" class="text-center mt-4 text-green-400 h-6"></p>
        <button type="button" class="mt-8 text-gray-300 underline" onclick="showPage('earnPage')">Go Back to Earn Page</button>
    </div>

    <!-- TASK à¦“ PROFILE PAGE (à¦…à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤) -->
    <div id="taskPage" class="page p-4 overflow-y-auto"><h1 class="text-3xl font-bold text-center mb-6">Complete Tasks</h1><div id="taskList" class="space-y-3"></div><p id="taskMessage" class="text-center mt-4 text-green-400"></p></div>
    <div id="profilePage" class="page p-4 items-center justify-center"><h1 class="text-3xl font-bold">Profile Page</h1><p class="mt-4">This section is coming soon!</p></div>
</main>
<!-- à¦¨à§‡à¦­à¦¿à¦—à§‡à¦¶à¦¨ (à¦…à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤) -->
<footer class="bg-black/30 p-2 z-10"><div class="swiper bottom-nav-slider"><div class="swiper-wrapper" id="navWrapper"></div></div><style>.nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;color:#9ca3af;padding:4px 0;cursor:pointer;transition:all .3s;width:25%!important}.nav-item.active,.nav-item:hover{color:#fff;transform:scale(1.1)}.nav-item span{font-size:.7rem;font-weight:500}</style></footer>
</div>

<script>
    const SERVER_URL = 'https://papa-earning-app.onrender.com';
    let gameState = {};
    let tgUser = {};
    
    // à¦Ÿà¦¾à¦¸à§à¦•à§‡à¦° à¦²à¦¿à¦¸à§à¦Ÿ (à¦†à¦—à§‡à¦° à¦®à¦¤à§‹à¦‡)
    const TASKS_DATA = {"task1":{"coins":50000,"usdt":.1,"title":"Join our Community"},"task2":{"coins":100000,"usdt":0,"title":"Follow us on X"}};

    // --- à¦¨à¦¤à§à¦¨: à¦¬à¦¿à¦œà§à¦žà¦¾à¦ªà¦¨ à¦Ÿà¦¾à¦¸à§à¦•à§‡à¦° à¦²à¦¿à¦¸à§à¦Ÿ ---
    const ADS_TASKS = [
        { id: "monetag_reward_1", title: "Monetag Rewarded Ad 1", icon: "ðŸ“º", reward: "25,000 COIN", status: "active", adType: "monetag_rewarded" },
        { id: "monetag_reward_2", title: "Monetag Rewarded Ad 2", icon: "âœ¨", reward: "15,000 COIN", status: "active", adType: "monetag_rewarded" },
        { id: "partner_ad_1", title: "New Partner Offer", icon: "ðŸ¤", reward: "50,000 COIN", status: "coming_soon", adType: null },
        { id: "video_ad_1", title: "Watch Short Video", icon: "ðŸŽ¬", reward: "5,000 COIN", status: "coming_soon", adType: null },
        { id: "special_promo", title: "Special Promo Ad", icon: "ðŸ’Ž", reward: "100,000 COIN", status: "coming_soon", adType: null }
    ];

    const navItemsConfig = [{"id":"earnPage","label":"Earn","icon":"..."},{"id":"adsPage","label":"Ads","icon":"..."},{"id":"taskPage","label":"Task","icon":"..."},{"id":"profilePage","label":"Profile","icon":"..."}];

    // --- à¦¨à¦¤à§à¦¨: à¦¬à¦¿à¦œà§à¦žà¦¾à¦ªà¦¨ à¦Ÿà¦¾à¦¸à§à¦• à¦¦à§‡à¦–à¦¾à¦¨à§‹à¦° à¦«à¦¾à¦‚à¦¶à¦¨ ---
    function renderAdsTasks() {
        const adListEl = document.getElementById('adTaskList');
        adListEl.innerHTML = ADS_TASKS.map(task => `
            <div class="bg-gray-800 p-4 rounded-lg flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <span class="text-3xl">${task.icon}</span>
                    <div>
                        <h3 class="font-bold">${task.title}</h3>
                        <p class="text-sm text-yellow-400">+ ${task.reward}</p>
                    </div>
                </div>
                <button type="button" data-task-id="${task.id}" 
                        class="ad-watch-btn font-bold py-2 px-5 rounded-lg 
                        ${task.status === 'active' ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-500 cursor-not-allowed'}"
                        ${task.status !== 'active' ? 'disabled' : ''}>
                    ${task.status === 'active' ? 'Go' : 'Soon'}
                </button>
            </div>
        `).join("");

        document.querySelectorAll('.ad-watch-btn').forEach(btn => btn.addEventListener('click', handleAdTaskClick));
    }
    
    // --- à¦¨à¦¤à§à¦¨: à¦¬à¦¿à¦œà§à¦žà¦¾à¦ªà¦¨ à¦Ÿà¦¾à¦¸à§à¦•à§‡à¦° à¦•à§à¦²à¦¿à¦• à¦¹à§à¦¯à¦¾à¦¨à§à¦¡à§‡à¦² à¦•à¦°à¦¾à¦° à¦«à¦¾à¦‚à¦¶à¦¨ ---
    async function handleAdTaskClick(event) {
        const button = event.target;
        const taskId = button.dataset.taskId;
        const task = ADS_TASKS.find(t => t.id === taskId);
        const adTaskMessage = document.getElementById('adTaskMessage');

        if (!task || task.status !== 'active') return;

        adTaskMessage.textContent = 'Loading ad... please wait.';
        button.disabled = true; // à¦à¦•à¦¬à¦¾à¦°à§‡ à¦à¦•à¦Ÿà¦¿à¦‡ à¦¬à¦¿à¦œà§à¦žà¦¾à¦ªà¦¨
        
        // Monetag SDK à¦•à¦² à¦•à¦°à¦¾
        show_9678845().then(() => {
            adTaskMessage.textContent = 'Ad watched successfully! Claiming reward...';
            claimAdReward(taskId, button);
        }).catch(() => {
            adTaskMessage.textContent = 'Ad was skipped. No reward.';
            button.disabled = false; // à¦†à¦¬à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à¦¾à¦° à¦¸à§à¦¯à§‹à¦—
        });
    }

    // --- à¦¨à¦¤à§à¦¨: à¦¬à¦¿à¦œà§à¦žà¦¾à¦ªà¦¨ à¦ªà§à¦°à¦¸à§à¦•à¦¾à¦° à¦¸à¦¾à¦°à§à¦­à¦¾à¦°à§‡ à¦ªà¦¾à¦ à¦¾à¦¨à§‹à¦° à¦«à¦¾à¦‚à¦¶à¦¨ ---
    async function claimAdReward(adId, buttonEl) {
        const adTaskMessage = document.getElementById('adTaskMessage');
        try {
            const response = await fetch(`${SERVER_URL}/api/reward_ad`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: tgUser.id || 'default_user', adId: adId })
            });
            const data = await response.json();
            if (response.ok) {
                adTaskMessage.textContent = data.message;
                gameState.balance = data.new_balance; // à¦¨à¦¤à§à¦¨ à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à¦†à¦ªà¦¡à§‡à¦Ÿ
                updateAllUI();
                buttonEl.textContent = 'Claimed'; // à¦¬à¦¾à¦Ÿà¦¨à¦Ÿà¦¿à¦•à§‡ 'Claimed' à¦•à¦°à§‡ à¦¦à§‡à¦“à§Ÿà¦¾
                buttonEl.classList.add('bg-green-600');
            } else {
                adTaskMessage.textContent = data.error;
                buttonEl.disabled = false; // à¦¸à¦¾à¦°à§à¦­à¦¾à¦° à¦à¦°à¦° à¦¹à¦²à§‡ à¦†à¦¬à¦¾à¦° à¦¸à§à¦¯à§‹à¦—
            }
        } catch(error) {
            adTaskMessage.textContent = "Server Error. Please try again.";
            buttonEl.disabled = false;
        }
    }

    // (à¦¬à¦¾à¦•à¦¿ JavaScript à¦•à§‹à¦¡ à¦…à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤)
    function showPage(e){document.querySelectorAll(".page").forEach(t=>t.classList.remove("active"));const t=document.getElementById(e);t&&t.classList.add("active"),document.querySelectorAll(".nav-item").forEach(t=>{t.classList.toggle("active",t.dataset.page===e)})}function formatNumber(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":Math.floor(e).toString()}function updateAllUI(){if(!gameState.balance)return;document.getElementById("coinBalance").textContent=formatNumber(gameState.balance.coins),document.getElementById("usdtBalance").textContent=gameState.balance.usdt.toFixed(2),document.getElementById("tonBalance").textContent=gameState.balance.ton.toFixed(2),document.getElementById("energyCounter").textContent=Math.floor(gameState.energy.current),document.getElementById("leagueName").textContent=gameState.profile.league}function createFloatingNumber(e,t){const a=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,o=document.createElement("div");o.className="floating-number",o.textContent=t,o.style.left=`${a}px`,o.style.top=`${n}px`,document.body.appendChild(o),setTimeout(()=>{o.style.transform="translateY(-100px)",o.style.opacity="0"},10),setTimeout(()=>{o.remove()},1e3)}function handleTap(e){if(gameState.energy.current<=0)return;const t=gameState.tap_stats.coins_per_tap;gameState.energy.current-=t,gameState.balance.coins+=t,document.getElementById("tap-circle").classList.add("tapped"),setTimeout(()=>document.getElementById("tap-circle").classList.remove("tapped"),100),createFloatingNumber(e,`+${t}`),updateAllUI()}function renderTasks(){const e=document.getElementById("taskList");e.innerHTML=Object.entries(TASKS_DATA).map(([t,a])=>`<div class="bg-gray-800 p-4 rounded-lg flex justify-between items-center"><div><h3 class="font-bold">${a.title}</h3><p class="text-sm text-yellow-400">+${a.coins.toLocaleString()} COIN, +${a.usdt} USDT</p></div><button type="button" data-task-id="${t}" class="task-claim-btn bg-blue-600 hover:bg-blue-700 font-bold py-2 px-5 rounded-lg disabled:bg-gray-500 disabled:cursor-not-allowed">Claim</button></div>`).join(""),document.querySelectorAll(".task-claim-btn").forEach(t=>t.addEventListener("click",handleCompleteTask)),updateCompletedTasksUI()}function updateCompletedTasksUI(){gameState.completed_tasks&&gameState.completed_tasks.forEach(e=>{const t=document.querySelector(`.task-claim-btn[data-task-id="${e}"]`);t&&(t.textContent="Claimed",t.disabled=!0)})}async function handleCompleteTask(e){const t=e.target,a=t.dataset.taskId,n=document.getElementById("taskMessage");n.textContent="Completing task...";try{const e=await fetch(`${SERVER_URL}/api/complete_task`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:tgUser.id||"default_user",taskId:a})}),o=await e.json();e.ok?(gameState.balance=o.new_balance,gameState.completed_tasks.push(a),n.textContent=o.message,updateAllUI(),updateCompletedTasksUI()):n.textContent=o.error}catch(e){n.textContent="Server Error!"}}
    setInterval(()=>{if(gameState?.energy?.current<gameState?.energy?.max){gameState.energy.current+=1;document.getElementById("energyCounter").textContent=Math.floor(gameState.energy.current)}},1000);

    window.addEventListener('load', async () => {
        try { if(typeof Telegram!=='undefined'){Telegram.WebApp.ready();tgUser=Telegram.WebApp.initDataUnsafe?.user||{};} } catch (e) { console.warn("Not in Telegram env."); }
        try { const response = await fetch(`${SERVER_URL}/api/data/${tgUser.id || 'default_user'}`); gameState = await response.json(); } catch(e) { console.error("Server connection failed:", e); alert("Could not connect to server!"); return; }
        const navWrapper=document.getElementById("navWrapper");navWrapper.innerHTML=navItemsConfig.map(t=>`<div class="swiper-slide nav-item" data-page="${t.id}">${t.icon}<span>${t.label}</span></div>`).join(""),new Swiper(".bottom-nav-slider",{slidesPerView:4,spaceBetween:10});
        document.querySelectorAll('.nav-item').forEach(t=>t.addEventListener("click",()=>showPage(t.dataset.page))),document.getElementById("tap-circle").addEventListener("click",handleTap);
        renderTasks(); renderAdsTasks(); updateAllUI(); showPage('earnPage');
    });
</script>
</body>
</html>