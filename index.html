<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PAPA TAP Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; overflow: hidden; }
        /* ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ‡¶™‡ßá‡¶á‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø CSS */
        .page {
            display: none;
            height: 100%;
            flex-direction: column;
        }
        .page.active {
            display: flex; /* flex ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü flexbox ‡¶¶‡¶ø‡ßü‡ßá ‡¶§‡ßà‡¶∞‡¶ø */
        }
        .tap-circle.tapped { transform: scale(0.95); }
        .floating-number { position: absolute; font-size: 2.5rem; font-weight: 800; color: white; opacity: 1; transition: all 1s ease-out; pointer-events: none; text-shadow: 0px 2px 4px rgba(0,0,0,0.5); }
    </style>
</head>
<body class="bg-gradient-to-t from-orange-600 to-yellow-500 text-white select-none">

<div id="app-container" class="flex flex-col h-screen max-w-md mx-auto bg-gray-900/70 backdrop-blur-md">
    
    <!-- Main content area for pages -->
    <main class="flex-grow overflow-hidden">
        
        <!-- EARN PAGE: ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -> 'active' ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü‡¶≠‡¶æ‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø -->
        <div id="earnPage" class="page active p-4 space-y-4">
            <header class="flex items-center justify-around space-x-2 bg-black/30 p-2 rounded-2xl">
                <div class="flex items-center space-x-1.5"><img src="https://img.icons8.com/fluency/48/stack-of-coins.png" alt="coin" class="w-8 h-8"><p id="coinBalance" class="font-bold text-lg">0</p></div>
                <div class="flex items-center space-x-1.5"><img src="https://img.icons8.com/color/48/us-dollar-circled--v1.png" alt="usdt" class="w-8 h-8"><p id="usdtBalance" class="font-bold text-lg">0.00</p></div>
                <!-- ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: TON ‡¶Ü‡¶á‡¶ï‡¶® ‡¶ï‡¶æ‡¶ú ‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ‡ßü SVG ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                <div class="flex items-center space-x-1.5">
                    <svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24ZM11.6596 5.33445C11.1969 5.33445 10.8242 5.70718 10.8242 6.16988V13.8055L6.99619 11.232C6.54133 10.9329 5.92336 11.0825 5.62419 11.5373C5.32503 11.9922 5.4746 12.6102 5.92947 12.9093L11.0421 16.5372C11.4552 16.8093 11.979 16.7441 12.3082 16.3917L18.3444 9.94726C18.7291 9.53775 18.6946 8.88714 18.285 8.50244C17.8755 8.11774 17.2249 8.15227 16.8402 8.56178L12.495 13.2085V6.16988C12.495 5.70718 12.1223 5.33445 11.6596 5.33445Z" fill="white"/></svg>
                    <p id="tonBalance" class="font-bold text-lg">0.00</p>
                </div>
            </header>

            <div id="tap-area" class="flex-grow flex flex-col items-center justify-center relative">
                <div id="tap-circle" class="tap-circle w-64 h-64 bg-gradient-to-br from-red-600 to-orange-500 rounded-full flex items-center justify-center shadow-2xl transition-transform duration-75 ease-in-out">
                    <p class="text-4xl font-black">TAP!</p>
                </div>
            </div>
            
            <section class="flex items-center justify-between space-x-4"><div class="flex items-center space-x-2"><img src="https://img.icons8.com/stickers/100/lightning-bolt.png" alt="energy" class="w-10 h-10"/><div class="pt-2"><p id="energyCounter" class="text-2xl font-bold leading-none">500 / 500</p></div></div>
            <button type="button" class="bg-red-500 hover:bg-red-600 font-bold py-3 px-8 rounded-full shadow-lg">üöÄ Boost</button></section>
        </div>

        <!-- TASK PAGE -->
        <div id="taskPage" class="page p-4 overflow-y-auto">
            <h1 class="text-3xl font-bold text-center mb-6">Tasks</h1>
            <div id="taskList" class="space-y-3"></div>
            <p id="taskMessage" class="text-center mt-4 text-green-400"></p>
        </div>

        <!-- PROFILE PAGE -->
        <div id="profilePage" class="page p-4 space-y-6">
            <div class="text-center">
                <img id="profileAvatar" src="https://img.icons8.com/fluency/96/user-male-circle--v1.png" alt="avatar" class="w-24 h-24 rounded-full mx-auto border-4 border-yellow-400">
                <h1 id="profileName" class="text-2xl font-bold mt-3">Player Name</h1>
                <div class="inline-flex items-center space-x-2 bg-gray-800 px-4 py-1 rounded-full mt-2">
                    <img src="https://img.icons8.com/arcade/64/trophy.png" class="w-5 h-5" alt="trophy"/>
                    <span id="profileLeague" class="font-semibold text-sm">Gold League</span>
                </div>
            </div>
            <div class="bg-black/30 p-4 rounded-xl space-y-3">
                <h2 class="font-bold text-lg text-yellow-300">Your Balances</h2>
                <div class="flex justify-between items-center"><span class="text-gray-300">COIN Balance</span><span id="profileCoin" class="font-bold">0</span></div>
                <div class="flex justify-between items-center"><span class="text-gray-300">USDT Balance</span><span id="profileUSDT" class="font-bold">0.00</span></div>
                <div class="flex justify-between items-center"><span class="text-gray-300">TON Balance</span><span id="profileTON" class="font-bold">0.00</span></div>
            </div>
            <button type="button" id="withdrawBtn" class="w-full bg-green-600 hover:bg-green-700 font-bold py-3 rounded-lg text-lg">üí∏ Withdraw</button>
        </div>
        
    </main>

    <footer class="bg-black/50 p-2 z-10">
        <div class="swiper bottom-nav-slider">
            <div class="swiper-wrapper" id="navWrapper"></div>
        </div>
        <style>.nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;color:#9ca3af;padding:4px 0;cursor:pointer;transition:all 0.3s;width:33.33%!important}.nav-item:hover,.nav-item.active{color:#fff}.nav-item.active{transform:scale(1.1)}.nav-item span{font-size:.7rem;font-weight:500}</style>
    </footer>
</div>

<script>
    const SERVER_URL = 'https://papa-earning-app.onrender.com';
    let gameState = {};
    let tgUser = {};
    const TASKS_DATA = { "task1": { "coins": 50000, "usdt": 0.1, "title": "Join our Community" }, "task2": { "coins": 100000, "usdt": 0.0, "title": "Follow us on X" }};

    const navItemsConfig = [
        { id: 'earnPage', label: 'Earn', icon: `<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path d="M11 12.592a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z"></path><path d="M21.129 11.238a9.141 9.141 0 1 0-11.832 9.043 8.852 8.852 0 0 1 2.94-.908 6.784 6.784 0 0 0 5.483-3.056 6.732 6.732 0 0 0-.214-7.238Z"></path></svg>`},
        { id: 'taskPage', label: 'Task', icon: `<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path d="M11.35 3.836A8.995 8.995 0 0 1 12 3c5.523 0 10 2.239 10 5s-4.477 5-10 5-10-2.239-10-5c0-1.294.613-2.484 1.583-3.327"></path><path d="M12 21a2 2 0 0 1-2-2v-6m4 8a2 2 0 0 0-2-2v-6m0 0a2 2 0 1 0-4 0v6a2 2 0 0 0 2 2m4 0a2 2 0 0 1 2-2v-6m0 0a2 2 0 1 1-4 0v6a2 2 0 0 1 2 2m-8-2.923A8.963 8.963 0 0 1 2.417 11.75 8.963 8.963 0 0 1 2 11c0-2.203 2.898-4.148 7-4.836"></path></svg>`},
        { id: 'profilePage', label: 'Profile', icon: `<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75a17.933 17.933 0 0 1-7.499-1.632Z"></path></svg>`}
    ];

    // ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ‡¶™‡ßá‡¶á‡¶ú ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const pageToShow = document.getElementById(pageId);
        if (pageToShow) {
            pageToShow.classList.add('active');
        }
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.toggle('active', item.dataset.page === pageId);
        });
    }
    
    // Functions for formatting, updating UI, etc. (unchanged but included)
    function formatNumber(num) { if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M'; if (num >= 1000) return (num / 1000).toFixed(1) + 'K'; return Math.floor(num).toString(); }
    function updateAllUI() {
        if (!gameState.balance) return; // Prevent error on initial load
        document.getElementById('coinBalance').textContent = formatNumber(gameState.balance.coins);
        document.getElementById('usdtBalance').textContent = gameState.balance.usdt.toFixed(2);
        document.getElementById('tonBalance').textContent = gameState.balance.ton.toFixed(2);
        document.getElementById('energyCounter').textContent = `${Math.floor(gameState.energy.current)} / ${gameState.energy.max}`;
        document.getElementById('profileName').textContent = gameState.profile.name;
        document.getElementById('profileLeague').textContent = gameState.profile.league;
        document.getElementById('profileCoin').textContent = formatNumber(gameState.balance.coins);
        document.getElementById('profileUSDT').textContent = gameState.balance.usdt.toFixed(2);
        document.getElementById('profileTON').textContent = gameState.balance.ton.toFixed(2);
    }
    function createFloatingNumber(e, text) { const x=e.clientX||e.touches[0].clientX; const y=e.clientY||e.touches[0].clientY; const n=document.createElement("div"); n.className="floating-number"; n.textContent=text; n.style.left=`${x}px`; n.style.top=`${y}px`; document.body.appendChild(n); setTimeout(()=>{n.style.transform="translateY(-100px)";n.style.opacity="0"},10); setTimeout(()=>{n.remove()},1000) }
    function handleTap(e) { if(gameState.energy.current<=0)return; const t=gameState.tap_stats.coins_per_tap;gameState.energy.current-=t;gameState.balance.coins+=t;document.getElementById("tap-circle").classList.add("tapped");setTimeout(()=>document.getElementById("tap-circle").classList.remove("tapped"),100);createFloatingNumber(e,`+${t}`);updateAllUI()}
    function renderTasks() {const e=document.getElementById("taskList");e.innerHTML=Object.entries(TASKS_DATA).map(([t,a])=>`<div class="bg-gray-800 p-4 rounded-lg flex justify-between items-center"><div><h3 class="font-bold">${a.title}</h3><p class="text-sm text-yellow-400">+${a.coins.toLocaleString()} COIN, +${a.usdt} USDT</p></div><button type="button" data-task-id="${t}" class="task-claim-btn bg-blue-600 hover:bg-blue-700 font-bold py-2 px-5 rounded-lg disabled:bg-gray-500 disabled:cursor-not-allowed">Claim</button></div>`).join("");document.querySelectorAll(".task-claim-btn").forEach(t=>t.addEventListener("click",handleCompleteTask));updateCompletedTasksUI()}
    function updateCompletedTasksUI(){if(gameState.completed_tasks)gameState.completed_tasks.forEach(e=>{const t=document.querySelector(`.task-claim-btn[data-task-id="${e}"]`);t&&(t.textContent="Claimed",t.disabled=!0)})}
    async function handleCompleteTask(e){const t=e.target,a=t.dataset.taskId,s=document.getElementById("taskMessage");s.textContent="Completing task...";try{const e=await fetch(`${SERVER_URL}/api/complete_task`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:tgUser.id||"default_user",taskId:a})}),c=await e.json();e.ok?(gameState.balance=c.new_balance,gameState.completed_tasks.push(a),s.textContent=c.message,updateAllUI(),updateCompletedTasksUI()):s.textContent=c.error}catch(e){s.textContent="Server Error!"}}
    setInterval(()=>{if(gameState?.energy?.current<gameState?.energy?.max){gameState.energy.current+=1;document.getElementById("energyCounter").textContent=`${Math.floor(gameState.energy.current)}/${gameState.energy.max}`}},1000);

    window.addEventListener('load', async () => {
        try { if(typeof Telegram!=='undefined'){Telegram.WebApp.ready();tgUser=Telegram.WebApp.initDataUnsafe?.user||{};} } catch (e) { console.warn("Not in Telegram env."); }

        try {
            const response = await fetch(`${SERVER_URL}/api/data/${tgUser.id || 'default_user'}`);
            if (!response.ok) throw new Error("Server not reachable");
            gameState = await response.json();
            gameState.profile.name = tgUser.first_name ? `${tgUser.first_name} ${tgUser.last_name || ''}`.trim() : 'PAPA Player';
        } catch(e) { console.error("Failed to load server data:", e); alert("Could not connect to the server. Please try again later."); return; }
        
        const navWrapper = document.getElementById('navWrapper');
        navWrapper.innerHTML = navItemsConfig.map(item => `<div class="swiper-slide nav-item" data-page="${item.id}">${item.icon}<span>${item.label}</span></div>`).join('');
        new Swiper('.bottom-nav-slider', { slidesPerView: 3, centeredSlides: true, spaceBetween: 10 });
        
        document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', () => showPage(item.dataset.page)));
        document.getElementById('tap-circle').addEventListener('click', handleTap);
        document.getElementById('withdrawBtn').addEventListener('click', () => alert('Withdrawal system is coming soon! Stay tuned!'));
        
        renderTasks();
        updateAllUI();
        showPage('earnPage'); // ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßá ‡¶Ø‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ Earn ‡¶™‡ßá‡¶á‡¶ú‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá
    });
</script>

</body>
</html>