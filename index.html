<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PAPA TAP Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- ‡¶®‡¶§‡ßÅ‡¶® CSS: ‡¶∏‡¶¨ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
    <style>
        body { font-family: 'Poppins', sans-serif; overflow: hidden; background-color: #1a1a2e; }
        
        /* 1. ‡¶™‡ßá‡¶á‡¶ú ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡¶ø‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        main { position: relative; } /* Important for absolute positioning of pages */
        .page {
            display: flex;
            position: absolute; /* Pages overlap for transition */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transform: scale(1.05);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .page.active {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }

        /* 2. ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤ */
        .tap-circle.tapped { transform: scale(0.95); }
        .tap-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, rgba(255,255,150,1) 0%, rgba(255,165,0,0) 70%);
            border-radius: 50%;
            pointer-events: none;
            transform: scale(1);
            opacity: 1;
            transition: transform 0.6s cubic-bezier(0.1, 0.7, 0.3, 1), opacity 0.6s linear;
        }

        /* 3. ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        #preloader { transition: opacity 0.5s ease-in-out; }

        /* ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶õ‡ßã‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .floating-number { position: absolute; font-size: 2.5rem; font-weight: 800; color: white; opacity: 1; transition: all 1s ease-out; pointer-events: none; text-shadow: 0 2px 4px #00000080; }
        .nav-item { display:flex; flex-direction:column; align-items:center; justify-content:center; color:#9ca3af; padding:4px 0; cursor:pointer; transition:all .3s; width:25%!important }
        .nav-item.active,.nav-item:hover { color:#fff; transform:scale(1.1) }
        .nav-item span { font-size:.7rem; font-weight:500 }
    </style>
</head>
<body class="bg-gradient-to-b from-gray-900 via-purple-900 to-gray-900 text-white select-none">

<!-- 1. ‡¶™‡ßç‡¶∞‡¶ø-‡¶≤‡ßã‡¶°‡¶æ‡¶∞ (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá) -->
<div id="preloader" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-50">
    <div class="animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-yellow-400"></div>
    <p class="mt-4 text-lg font-semibold">Loading PAPA Game...</p>
</div>


<div id="app-container" class="flex flex-col h-screen max-w-md mx-auto bg-black/40">
<main class="flex-grow overflow-hidden">
    <!-- EARN PAGE -->
    <div id="earnPage" class="page active p-4 space-y-4">
        <header class="flex items-center justify-around space-x-2 bg-black/20 p-2 rounded-2xl">
            <!-- ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø data-value ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßç‡¶∞‡¶ø‡¶¨‡¶ø‡¶â‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
            <div class="flex items-center space-x-1.5"><img src="https://img.icons8.com/fluency/48/stack-of-coins.png" alt="coin" class="w-7 h-7"><p id="coinBalance" data-value="0" class="font-bold">0</p></div>
            <div class="flex items-center space-x-1.5"><img src="https://img.icons8.com/color/48/us-dollar-circled--v1.png" alt="usdt" class="w-7 h-7"><p id="usdtBalance" data-value="0" class="font-bold">0.00</p></div>
            <div class="flex items-center space-x-1.5"><svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24ZM11.6596 5.33445C11.1969 5.33445 10.8242 5.70718 10.8242 6.16988V13.8055L6.99619 11.232C6.54133 10.9329 5.92336 11.0825 5.62419 11.5373C5.32503 11.9922 5.4746 12.6102 5.92947 12.9093L11.0421 16.5372C11.4552 16.8093 11.979 16.7441 12.3082 16.3917L18.3444 9.94726C18.7291 9.53775 18.6946 8.88714 18.285 8.50244C17.8755 8.11774 17.2249 8.15227 16.8402 8.56178L12.495 13.2085V6.16988C12.495 5.70718 12.1223 5.33445 11.6596 5.33445Z" fill="white"></path></svg><p id="tonBalance" class="font-bold">0.00</p></div>
        </header>
        <section class="flex justify-between items-center px-2"> <button type="button" class="bg-gray-800/80 px-4 py-2 rounded-lg font-semibold flex items-center space-x-2"><img src="https://img.icons8.com/arcade/64/trophy.png" alt="trophy" class="w-6 h-6"><span id="leagueName">Gold</span></button> <button type="button" onclick="showPage('adsPage')" class="bg-red-600 px-6 py-2 rounded-lg font-bold">Ads to Earn</button> </section>
        <div id="tap-area" class="flex-grow flex flex-col items-center justify-center relative"> <div id="tap-circle" class="tap-circle w-60 h-60 bg-gradient-to-br from-red-500 to-orange-600 rounded-full flex items-center justify-center shadow-2xl transition-transform duration-75 ease-in-out cursor-pointer"> <p class="text-3xl font-black text-center">Click Game<br>Tap Tap</p> </div> </div>
        <section class="flex items-center justify-between px-2"> <div class="flex items-center space-x-2"> <img src="https://img.icons8.com/stickers/100/lightning-bolt.png" alt="energy" class="w-10 h-10"> <p id="energyCounter" class="text-2xl font-bold">200</p> </div> <button type="button" class="bg-red-500 hover:bg-red-600 font-bold py-3 px-8 rounded-full shadow-lg">üöÄ Boost</button> </section>
    </div>
    <!-- (‡¶¨‡¶æ‡¶ï‡¶ø ‡¶∏‡¶¨ ‡¶™‡ßá‡¶á‡¶ú ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) -->
    <div id="adsPage" class="page p-4 overflow-y-auto"> ... </div>
    <div id="taskPage" class="page p-4 overflow-y-auto"> ... </div>
    <div id="profilePage" class="page p-4 items-center justify-center"> ... </div>
</main>
<footer class="bg-black/30 p-2 z-10"><div class="swiper bottom-nav-slider"><div class="swiper-wrapper" id="navWrapper"></div></div></footer>
</div>

<script>
    // --- Configuration (‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) ---
    const SERVER_URL = 'https://papa-earning-app.onrender.com';
    let gameState = {};
    let tgUser = {};

    // --- DOM Elements (‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) ---

    // --- ‡¶®‡¶§‡ßÅ‡¶®: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶ü‡ßá‡¶° ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
    function animateValue(element, start, end, duration, formatFunc = (val) => Math.floor(val)) {
        if (start === end) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            element.innerHTML = formatFunc(progress * (end - start) + start);
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }
    
    // --- ‡¶®‡¶§‡ßÅ‡¶®: ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
    function createTapParticles(e) {
        const x = e.clientX || e.touches[0].clientX;
        const y = e.clientY || e.touches[0].clientY;
        for (let i = 0; i < 8; i++) {
            const particle = document.createElement('div');
            particle.className = 'tap-particle';
            document.body.appendChild(particle);
            const angle = Math.random() * 2 * Math.PI;
            const distance = Math.random() * 60 + 30;
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            setTimeout(() => {
                particle.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`;
                particle.style.opacity = '0';
            }, 10);
            setTimeout(() => particle.remove(), 610);
        }
    }

    // --- ‡¶®‡¶§‡ßÅ‡¶®: ‡¶™‡ßá‡¶á‡¶ú ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡¶ø‡¶∂‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
    function showPage(pageId) {
        const currentPage = document.querySelector('.page.active');
        const nextPage = document.getElementById(pageId);
        if (currentPage && nextPage && currentPage.id !== pageId) {
            currentPage.classList.remove('active');
            nextPage.classList.add('active');
        }
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.toggle('active', item.dataset.page === pageId);
        });
    }

    // --- handleTap ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ---
    function handleTap(e) {
        if (gameState.energy.current <= 0) return;
        createTapParticles(e); // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
        // ... (‡¶¨‡¶æ‡¶ï‡¶ø ‡¶ï‡ßã‡¶° ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) ...
    }

    // --- updateAllUI ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ---
    function updateAllUI() {
        if (!gameState.balance) return;
        const coinEl = document.getElementById('coinBalance');
        const usdtEl = document.getElementById('usdtBalance');
        const oldCoins = parseFloat(coinEl.dataset.value) || 0;
        const oldUsdt = parseFloat(usdtEl.dataset.value) || 0;

        animateValue(coinEl, oldCoins, gameState.balance.coins, 500, formatNumber);
        animateValue(usdtEl, oldUsdt, gameState.balance.usdt, 500, (val) => val.toFixed(8));

        coinEl.dataset.value = gameState.balance.coins;
        usdtEl.dataset.value = gameState.balance.usdt;

        // ... (‡¶¨‡¶æ‡¶ï‡¶ø UI ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü)
    }


    // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ---
    window.addEventListener('load', async () => {
        // ... (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶´‡ßá‡¶ö ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßá‡¶ü‡¶æ‡¶™ ‡¶ï‡ßã‡¶° ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§)
        
        // ‡¶∏‡¶¨‡¶∂‡ßá‡¶∑‡ßá ‡¶™‡ßç‡¶∞‡¶ø-‡¶≤‡ßã‡¶°‡¶æ‡¶∞ Ïà®‡¶æ‡¶®‡ßã
        const preloader = document.getElementById('preloader');
        preloader.style.opacity = '0';
        setTimeout(() => preloader.style.display = 'none', 500);
    });

    // (‡¶¨‡¶æ‡¶ï‡¶ø ‡¶∏‡¶¨ ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá)
</script>
</body>
</html>